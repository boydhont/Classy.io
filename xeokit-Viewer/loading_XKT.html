<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>xeokit-sdk Visual Test</title>
</head>
<style>
    body {
        margin: 0;
        width: 100%;
        height: 100%;
        user-select: none;
    }

    #myCanvas {
        width: 100%;
        height: 100%;
        position: absolute;
        background: lightblue;
        background-image: linear-gradient(lightblue, white);
    }
</style>
<body>
<canvas id="myCanvas"></canvas>
</body>
<script type="module">

    import {Viewer, XKTLoaderPlugin} from "./node_modules/@xeokit/xeokit-sdk/dist/xeokit-sdk.es.js";

//------------------------------------------------------------------------------------------------------------------
// 1. Create a Viewer,
// 2. Arrange the camera
//------------------------------------------------------------------------------------------------------------------

// 1
const viewer = new Viewer({
     canvasId: "myCanvas",
     transparent: true
});

// 2
viewer.camera.eye = [-2.56, 8.38, 8.27];
viewer.camera.look = [13.44, 3.31, -14.83];
viewer.camera.up = [0.10, 0.98, -0.14];

//------------------------------------------------------------------------------------------------------------------
// 1. Create a XKTLoaderPlugin,
// 2. Load a building model and JSON IFC metadata
//------------------------------------------------------------------------------------------------------------------

// 1
const xktLoader = new XKTLoaderPlugin(viewer);

// 2
const model = xktLoader.load({          // Returns an Entity that represents the model
    id: "myModel",
    src: "../assets/XKT/Schependomlaan_Schependomlaan/cxConverter1_Schependomlaan_Schependomlaan/model.xkt",
    edges: true
});

model.on("loaded", () => {

    //--------------------------------------------------------------------------------------------------------------
    // 1. Find metadata on the third storey
    // 2. Select all the objects in the building's third storey
    // 3. Fit the camera to all the objects on the third storey
    //--------------------------------------------------------------------------------------------------------------

    // 1
    const metaModel = viewer.metaScene.metaModels["myModel"];       // MetaModel with ID "myModel"
    const metaObject
         = viewer.metaScene.metaObjects["0u4wgLe6n0ABVaiXyikbkA"];  // MetaObject with ID "0u4wgLe6n0ABVaiXyikbkA"

    const name = metaObject.name;                                   // "01 eerste verdieping"
    const type = metaObject.type;                                   // "IfcBuildingStorey"
    const parent = metaObject.parent;                               // MetaObject with type "IfcBuilding"
    const children = metaObject.children;                           // Array of child MetaObjects
    const objectId = metaObject.id;                                 // "0u4wgLe6n0ABVaiXyikbkA"
    const objectIds = viewer.metaScene.getObjectIDsInSubtree(objectId);   // IDs of leaf sub-objects
    const aabb = viewer.scene.getAABB(objectIds);                   // Axis-aligned boundary of the leaf sub-objects

    // 2
    viewer.scene.setObjectsSelected(objectIds, true);

    // 3
    viewer.cameraFlight.flyTo(aabb);
});

// Find the model Entity by ID
//model = viewer.scene.models["myModel"];

    window.viewer = viewer;

// Destroy the model
//model.destroy();    window.viewer = viewer;

</script>
</html>