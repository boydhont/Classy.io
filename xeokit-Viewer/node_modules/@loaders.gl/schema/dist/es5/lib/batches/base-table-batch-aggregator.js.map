{"version":3,"file":"base-table-batch-aggregator.js","names":["DEFAULT_ROW_COUNT","RowTableBatchAggregator","schema","options","_classCallCheck2","default","_defineProperty2","Array","isArray","_headers","key","index","name","_createClass2","value","rowCount","length","addArrayRow","row","cursor","Number","isFinite","rows","addObjectRow","getBatch","slice","batch","shape","batchType","data","exports"],"sources":["../../../../src/lib/batches/base-table-batch-aggregator.ts"],"sourcesContent":["import type {Schema} from '../schema/schema';\nimport type {TableBatch} from '../../category/table/table-types';\nimport {TableBatchAggregator, TableBatchOptions} from './table-batch-aggregator';\n\nconst DEFAULT_ROW_COUNT = 100;\n\nexport default class RowTableBatchAggregator implements TableBatchAggregator {\n  schema: Schema;\n  options: TableBatchOptions;\n\n  length: number = 0;\n  rows: any[] | null = null;\n  cursor: number = 0;\n  private _headers: string[] = [];\n\n  constructor(schema: Schema, options: TableBatchOptions) {\n    this.options = options;\n    this.schema = schema;\n\n    // schema is an array if there're no headers\n    // object if there are headers\n    if (!Array.isArray(schema)) {\n      this._headers = [];\n      for (const key in schema) {\n        this._headers[schema[key].index] = schema[key].name;\n      }\n    }\n  }\n\n  rowCount(): number {\n    return this.length;\n  }\n\n  addArrayRow(row: any[], cursor?: number): void {\n    if (Number.isFinite(cursor)) {\n      this.cursor = cursor as number;\n    }\n\n    this.rows = this.rows || new Array(DEFAULT_ROW_COUNT);\n    this.rows[this.length] = row;\n    this.length++;\n  }\n\n  addObjectRow(row: {[columnName: string]: any}, cursor?: number): void {\n    if (Number.isFinite(cursor)) {\n      this.cursor = cursor as number;\n    }\n\n    this.rows = this.rows || new Array(DEFAULT_ROW_COUNT);\n    this.rows[this.length] = row;\n    this.length++;\n  }\n\n  getBatch(): TableBatch | null {\n    let rows = this.rows;\n    if (!rows) {\n      return null;\n    }\n\n    rows = rows.slice(0, this.length);\n    this.rows = null;\n\n    const batch: TableBatch = {\n      shape: this.options.shape,\n      batchType: 'data',\n      data: rows,\n      length: this.length,\n      schema: this.schema,\n      cursor: this.cursor\n    };\n\n    return batch;\n  }\n}\n"],"mappings":";;;;;;;;;;AAIA,IAAMA,iBAAiB,GAAG,GAAG;AAAC,IAETC,uBAAuB;EAS1C,SAAAA,wBAAYC,MAAc,EAAEC,OAA0B,EAAE;IAAA,IAAAC,gBAAA,CAAAC,OAAA,QAAAJ,uBAAA;IAAA,IAAAK,gBAAA,CAAAD,OAAA;IAAA,IAAAC,gBAAA,CAAAD,OAAA;IAAA,IAAAC,gBAAA,CAAAD,OAAA,kBALvC,CAAC;IAAA,IAAAC,gBAAA,CAAAD,OAAA,gBACG,IAAI;IAAA,IAAAC,gBAAA,CAAAD,OAAA,kBACR,CAAC;IAAA,IAAAC,gBAAA,CAAAD,OAAA,oBACW,EAAE;IAG7B,IAAI,CAACF,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACD,MAAM,GAAGA,MAAM;IAIpB,IAAI,CAACK,KAAK,CAACC,OAAO,CAACN,MAAM,CAAC,EAAE;MAC1B,IAAI,CAACO,QAAQ,GAAG,EAAE;MAClB,KAAK,IAAMC,GAAG,IAAIR,MAAM,EAAE;QACxB,IAAI,CAACO,QAAQ,CAACP,MAAM,CAACQ,GAAG,CAAC,CAACC,KAAK,CAAC,GAAGT,MAAM,CAACQ,GAAG,CAAC,CAACE,IAAI;MACrD;IACF;EACF;EAAC,IAAAC,aAAA,CAAAR,OAAA,EAAAJ,uBAAA;IAAAS,GAAA;IAAAI,KAAA,EAED,SAAAC,SAAA,EAAmB;MACjB,OAAO,IAAI,CAACC,MAAM;IACpB;EAAC;IAAAN,GAAA;IAAAI,KAAA,EAED,SAAAG,YAAYC,GAAU,EAAEC,MAAe,EAAQ;MAC7C,IAAIC,MAAM,CAACC,QAAQ,CAACF,MAAM,CAAC,EAAE;QAC3B,IAAI,CAACA,MAAM,GAAGA,MAAgB;MAChC;MAEA,IAAI,CAACG,IAAI,GAAG,IAAI,CAACA,IAAI,IAAI,IAAIf,KAAK,CAACP,iBAAiB,CAAC;MACrD,IAAI,CAACsB,IAAI,CAAC,IAAI,CAACN,MAAM,CAAC,GAAGE,GAAG;MAC5B,IAAI,CAACF,MAAM,EAAE;IACf;EAAC;IAAAN,GAAA;IAAAI,KAAA,EAED,SAAAS,aAAaL,GAAgC,EAAEC,MAAe,EAAQ;MACpE,IAAIC,MAAM,CAACC,QAAQ,CAACF,MAAM,CAAC,EAAE;QAC3B,IAAI,CAACA,MAAM,GAAGA,MAAgB;MAChC;MAEA,IAAI,CAACG,IAAI,GAAG,IAAI,CAACA,IAAI,IAAI,IAAIf,KAAK,CAACP,iBAAiB,CAAC;MACrD,IAAI,CAACsB,IAAI,CAAC,IAAI,CAACN,MAAM,CAAC,GAAGE,GAAG;MAC5B,IAAI,CAACF,MAAM,EAAE;IACf;EAAC;IAAAN,GAAA;IAAAI,KAAA,EAED,SAAAU,SAAA,EAA8B;MAC5B,IAAIF,IAAI,GAAG,IAAI,CAACA,IAAI;MACpB,IAAI,CAACA,IAAI,EAAE;QACT,OAAO,IAAI;MACb;MAEAA,IAAI,GAAGA,IAAI,CAACG,KAAK,CAAC,CAAC,EAAE,IAAI,CAACT,MAAM,CAAC;MACjC,IAAI,CAACM,IAAI,GAAG,IAAI;MAEhB,IAAMI,KAAiB,GAAG;QACxBC,KAAK,EAAE,IAAI,CAACxB,OAAO,CAACwB,KAAK;QACzBC,SAAS,EAAE,MAAM;QACjBC,IAAI,EAAEP,IAAI;QACVN,MAAM,EAAE,IAAI,CAACA,MAAM;QACnBd,MAAM,EAAE,IAAI,CAACA,MAAM;QACnBiB,MAAM,EAAE,IAAI,CAACA;MACf,CAAC;MAED,OAAOO,KAAK;IACd;EAAC;EAAA,OAAAzB,uBAAA;AAAA;AAAA6B,OAAA,CAAAzB,OAAA,GAAAJ,uBAAA"}