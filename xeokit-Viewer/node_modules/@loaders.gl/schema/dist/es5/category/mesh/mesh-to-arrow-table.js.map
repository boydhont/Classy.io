{"version":3,"file":"mesh-to-arrow-table.js","names":["_Arrow","require","_arrowTypeUtils","_deduceMeshSchema","convertMeshToArrowTable","mesh","batchSize","_mesh$schema","vectors","fields","attributeKey","attributes","attribute","value","_attribute$size","size","type","getArrowType","vector","getArrowVector","listType","FixedSizeList","Field","field","makeMeshAttributeMetadata","data","Data","length","undefined","listVector","FixedSizeListVector","push","schema","Schema","metadata","Map","recordBatch","RecordBatch","table","Table"],"sources":["../../../../src/category/mesh/mesh-to-arrow-table.ts"],"sourcesContent":["import {\n  Table,\n  Schema,\n  RecordBatch,\n  FixedSizeList,\n  Field,\n  Data,\n  FixedSizeListVector\n} from 'apache-arrow/Arrow.dom';\nimport {AbstractVector} from 'apache-arrow/vector';\nimport {getArrowType, getArrowVector} from '../../lib/arrow/arrow-type-utils';\nimport type {Mesh} from './mesh-types';\nimport {makeMeshAttributeMetadata} from './deduce-mesh-schema';\n\n/**\n * * Convert a loaders.gl Mesh to an Apache Arrow Table\n * @param mesh\n * @param metadata\n * @param batchSize\n * @returns\n */\nexport function convertMeshToArrowTable(mesh: Mesh, batchSize?: number): Table {\n  const vectors: AbstractVector[] = [];\n  const fields: Field[] = [];\n  for (const attributeKey in mesh.attributes) {\n    const attribute = mesh.attributes[attributeKey];\n    const {value, size = 1} = attribute;\n    const type = getArrowType(value);\n    const vector = getArrowVector(value);\n    const listType = new FixedSizeList(size, new Field('value', type));\n    const field = new Field(attributeKey, listType, false, makeMeshAttributeMetadata(attribute));\n    const data = new Data(listType, 0, value.length / size, 0, undefined, [vector]);\n    const listVector = new FixedSizeListVector(data);\n    vectors.push(listVector);\n    fields.push(field);\n  }\n  const schema = new Schema(fields, mesh?.schema?.metadata || new Map<string, string>());\n  const recordBatch = new RecordBatch(schema, vectors[0].length, vectors);\n  const table = new Table(schema, recordBatch);\n  return table;\n}\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAUA,IAAAC,eAAA,GAAAD,OAAA;AAEA,IAAAE,iBAAA,GAAAF,OAAA;AASO,SAASG,uBAAuBA,CAACC,IAAU,EAAEC,SAAkB,EAAS;EAAA,IAAAC,YAAA;EAC7E,IAAMC,OAAyB,GAAG,EAAE;EACpC,IAAMC,MAAe,GAAG,EAAE;EAC1B,KAAK,IAAMC,YAAY,IAAIL,IAAI,CAACM,UAAU,EAAE;IAC1C,IAAMC,SAAS,GAAGP,IAAI,CAACM,UAAU,CAACD,YAAY,CAAC;IAC/C,IAAOG,KAAK,GAAcD,SAAS,CAA5BC,KAAK;MAAAC,eAAA,GAAcF,SAAS,CAArBG,IAAI;MAAJA,IAAI,GAAAD,eAAA,cAAG,CAAC,GAAAA,eAAA;IACtB,IAAME,IAAI,GAAG,IAAAC,4BAAY,EAACJ,KAAK,CAAC;IAChC,IAAMK,MAAM,GAAG,IAAAC,8BAAc,EAACN,KAAK,CAAC;IACpC,IAAMO,QAAQ,GAAG,IAAIC,oBAAa,CAACN,IAAI,EAAE,IAAIO,YAAK,CAAC,OAAO,EAAEN,IAAI,CAAC,CAAC;IAClE,IAAMO,KAAK,GAAG,IAAID,YAAK,CAACZ,YAAY,EAAEU,QAAQ,EAAE,KAAK,EAAE,IAAAI,2CAAyB,EAACZ,SAAS,CAAC,CAAC;IAC5F,IAAMa,IAAI,GAAG,IAAIC,WAAI,CAACN,QAAQ,EAAE,CAAC,EAAEP,KAAK,CAACc,MAAM,GAAGZ,IAAI,EAAE,CAAC,EAAEa,SAAS,EAAE,CAACV,MAAM,CAAC,CAAC;IAC/E,IAAMW,UAAU,GAAG,IAAIC,0BAAmB,CAACL,IAAI,CAAC;IAChDjB,OAAO,CAACuB,IAAI,CAACF,UAAU,CAAC;IACxBpB,MAAM,CAACsB,IAAI,CAACR,KAAK,CAAC;EACpB;EACA,IAAMS,MAAM,GAAG,IAAIC,aAAM,CAACxB,MAAM,EAAE,CAAAJ,IAAI,aAAJA,IAAI,wBAAAE,YAAA,GAAJF,IAAI,CAAE2B,MAAM,cAAAzB,YAAA,uBAAZA,YAAA,CAAc2B,QAAQ,KAAI,IAAIC,GAAG,CAAiB,CAAC,CAAC;EACtF,IAAMC,WAAW,GAAG,IAAIC,kBAAW,CAACL,MAAM,EAAExB,OAAO,CAAC,CAAC,CAAC,CAACmB,MAAM,EAAEnB,OAAO,CAAC;EACvE,IAAM8B,KAAK,GAAG,IAAIC,YAAK,CAACP,MAAM,EAAEI,WAAW,CAAC;EAC5C,OAAOE,KAAK;AACd"}