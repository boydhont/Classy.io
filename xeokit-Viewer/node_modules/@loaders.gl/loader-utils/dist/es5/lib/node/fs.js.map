{"version":3,"file":"fs.js","names":["_fs","_interopRequireDefault","require","_buffer","_promisify","readdir","promisify2","fs","exports","stat","readFile","readFileSync","writeFile","promisify3","writeFileSync","open","close","fd","Promise","resolve","reject","err","read","fstat","createWriteStream","isSupported","Boolean","_readToArrayBuffer","_x","_x2","_x3","_readToArrayBuffer2","apply","arguments","_asyncToGenerator2","default","_regenerator","mark","_callee","start","length","buffer","_yield$read","bytesRead","wrap","_callee$","_context","prev","next","Buffer","alloc","sent","Error","abrupt","toArrayBuffer","stop"],"sources":["../../../../src/lib/node/fs.ts"],"sourcesContent":["// fs wrapper (promisified fs + avoids bundling fs in browsers)\nimport fs from 'fs';\nimport {toArrayBuffer} from './buffer';\nimport {promisify2, promisify3} from './promisify';\n\nexport type {Stats, WriteStream} from 'fs';\n\n/** Wrapper for Node.js fs method */\nexport const readdir: any = promisify2(fs.readdir);\n/** Wrapper for Node.js fs method */\nexport const stat: any = promisify2(fs.stat);\n\n/** Wrapper for Node.js fs method */\nexport const readFile: any = fs.readFile;\n/** Wrapper for Node.js fs method */\nexport const readFileSync = fs.readFileSync;\n/** Wrapper for Node.js fs method */\nexport const writeFile: any = promisify3(fs.writeFile);\n/** Wrapper for Node.js fs method */\nexport const writeFileSync = fs.writeFileSync;\n\n// file descriptors\n\n/** Wrapper for Node.js fs method */\nexport const open: any = fs.open;\n/** Wrapper for Node.js fs method */\nexport const close = (fd: number) =>\n  new Promise<void>((resolve, reject) => fs.close(fd, (err) => (err ? reject(err) : resolve())));\n/** Wrapper for Node.js fs method */\nexport const read: any = fs.read;\n/** Wrapper for Node.js fs method */\nexport const fstat: any = fs.fstat;\n\nexport const createWriteStream = fs.createWriteStream;\n\nexport const isSupported = Boolean(fs);\n\nexport async function _readToArrayBuffer(fd: number, start: number, length: number) {\n  const buffer = Buffer.alloc(length);\n  const {bytesRead} = await read(fd, buffer, 0, length, start);\n  if (bytesRead !== length) {\n    throw new Error('fs.read failed');\n  }\n  return toArrayBuffer(buffer);\n}\n"],"mappings":";;;;;;;;;;AACA,IAAAA,GAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,OAAA,GAAAD,OAAA;AACA,IAAAE,UAAA,GAAAF,OAAA;AAKO,IAAMG,OAAY,GAAG,IAAAC,qBAAU,EAACC,WAAE,CAACF,OAAO,CAAC;AAACG,OAAA,CAAAH,OAAA,GAAAA,OAAA;AAE5C,IAAMI,IAAS,GAAG,IAAAH,qBAAU,EAACC,WAAE,CAACE,IAAI,CAAC;AAACD,OAAA,CAAAC,IAAA,GAAAA,IAAA;AAGtC,IAAMC,QAAa,GAAGH,WAAE,CAACG,QAAQ;AAACF,OAAA,CAAAE,QAAA,GAAAA,QAAA;AAElC,IAAMC,YAAY,GAAGJ,WAAE,CAACI,YAAY;AAACH,OAAA,CAAAG,YAAA,GAAAA,YAAA;AAErC,IAAMC,SAAc,GAAG,IAAAC,qBAAU,EAACN,WAAE,CAACK,SAAS,CAAC;AAACJ,OAAA,CAAAI,SAAA,GAAAA,SAAA;AAEhD,IAAME,aAAa,GAAGP,WAAE,CAACO,aAAa;AAACN,OAAA,CAAAM,aAAA,GAAAA,aAAA;AAKvC,IAAMC,IAAS,GAAGR,WAAE,CAACQ,IAAI;AAACP,OAAA,CAAAO,IAAA,GAAAA,IAAA;AAE1B,IAAMC,KAAK,GAAG,SAARA,KAAKA,CAAIC,EAAU;EAAA,OAC9B,IAAIC,OAAO,CAAO,UAACC,OAAO,EAAEC,MAAM;IAAA,OAAKb,WAAE,CAACS,KAAK,CAACC,EAAE,EAAE,UAACI,GAAG;MAAA,OAAMA,GAAG,GAAGD,MAAM,CAACC,GAAG,CAAC,GAAGF,OAAO,CAAC,CAAC;IAAA,CAAC,CAAC;EAAA,EAAC;AAAA;AAACX,OAAA,CAAAQ,KAAA,GAAAA,KAAA;AAE1F,IAAMM,IAAS,GAAGf,WAAE,CAACe,IAAI;AAACd,OAAA,CAAAc,IAAA,GAAAA,IAAA;AAE1B,IAAMC,KAAU,GAAGhB,WAAE,CAACgB,KAAK;AAACf,OAAA,CAAAe,KAAA,GAAAA,KAAA;AAE5B,IAAMC,iBAAiB,GAAGjB,WAAE,CAACiB,iBAAiB;AAAChB,OAAA,CAAAgB,iBAAA,GAAAA,iBAAA;AAE/C,IAAMC,WAAW,GAAGC,OAAO,CAACnB,WAAE,CAAC;AAACC,OAAA,CAAAiB,WAAA,GAAAA,WAAA;AAAA,SAEjBE,kBAAkBA,CAAAC,EAAA,EAAAC,GAAA,EAAAC,GAAA;EAAA,OAAAC,mBAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAF,oBAAA;EAAAA,mBAAA,OAAAG,kBAAA,CAAAC,OAAA,EAAAC,YAAA,CAAAD,OAAA,CAAAE,IAAA,CAAjC,SAAAC,QAAkCrB,EAAU,EAAEsB,KAAa,EAAEC,MAAc;IAAA,IAAAC,MAAA,EAAAC,WAAA,EAAAC,SAAA;IAAA,OAAAP,YAAA,CAAAD,OAAA,CAAAS,IAAA,UAAAC,SAAAC,QAAA;MAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;QAAA;UAC1EP,MAAM,GAAGQ,MAAM,CAACC,KAAK,CAACV,MAAM,CAAC;UAAAM,QAAA,CAAAE,IAAA;UAAA,OACT1B,IAAI,CAACL,EAAE,EAAEwB,MAAM,EAAE,CAAC,EAAED,MAAM,EAAED,KAAK,CAAC;QAAA;UAAAG,WAAA,GAAAI,QAAA,CAAAK,IAAA;UAArDR,SAAS,GAAAD,WAAA,CAATC,SAAS;UAAA,MACZA,SAAS,KAAKH,MAAM;YAAAM,QAAA,CAAAE,IAAA;YAAA;UAAA;UAAA,MAChB,IAAII,KAAK,CAAC,gBAAgB,CAAC;QAAA;UAAA,OAAAN,QAAA,CAAAO,MAAA,WAE5B,IAAAC,qBAAa,EAACb,MAAM,CAAC;QAAA;QAAA;UAAA,OAAAK,QAAA,CAAAS,IAAA;MAAA;IAAA,GAAAjB,OAAA;EAAA,CAC7B;EAAA,OAAAP,mBAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA"}